<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactoring Opportunity Review January 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <style>
        .mermaid { 
            background: #f8fafc; 
            border-radius: 0.5rem; 
            padding: 1rem; 
            margin: 1rem 0;
        }
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #10b981; }
        pre[class*="language-"] { 
            border-radius: 0.5rem; 
            font-size: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .code-block {
            background: #1e293b;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        .code-block code {
            color: #e2e8f0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .file-path {
            background: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.75rem;
            display: inline-block;
            margin: 0.25rem 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .issue-card {
            transition: all 0.3s ease;
        }
        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print { display: none; }
            .mermaid { page-break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold">Refactoring Opportunity Review</h1>
                        <p class="mt-2 text-blue-100">FPL Team Management Application</p>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-semibold">January 2026</p>
                        <p class="text-blue-100">Comprehensive Architecture Analysis</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Executive Summary -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Executive Summary</h2>
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="metric-card">
                        <div class="text-3xl font-bold">15,000</div>
                        <div class="text-sm opacity-90">Total Lines of Code</div>
                    </div>
                    <div class="metric-card">
                        <div class="text-3xl font-bold">15%</div>
                        <div class="text-sm opacity-90">Code Duplication</div>
                    </div>
                    <div class="metric-card">
                        <div class="text-3xl font-bold">162</div>
                        <div class="text-sm opacity-90">Test Cases</div>
                    </div>
                    <div class="metric-card">
                        <div class="text-3xl font-bold">691</div>
                        <div class="text-sm opacity-90">Lines in God Class</div>
                    </div>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    This comprehensive analysis identifies critical refactoring opportunities in the FPL Team Management application. 
                    Key findings include significant code duplication in normalization logic, a persistent God Class pattern in the main controller, 
                    and fragmented storage abstraction. The proposed roadmap offers a systematic approach to modernize the architecture while 
                    maintaining functionality and improving maintainability.
                </p>
            </div>
        </section>

        <!-- Current Architecture -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Current Architecture</h2>
                <div class="mermaid">
graph TB
    subgraph "Frontend Layer"
        UI[UIManager<br/>501 lines]
        TM[FPLTeamManager<br/>691 lines - God Class]
        INIT[App Initialization<br/>569 lines]
    end
    
    subgraph "Storage Abstraction"
        SM[Storage Module<br/>Factory Pattern]
        LS[LocalStorageService]
        IDB[StorageServiceDB<br/>IndexedDB]
        SQLITE[SQLiteStorageService]
    end
    
    subgraph "Storage Adapters"
        LSA[LocalStorage Adapter]
        IDBA[IndexedDB Adapter]
        SQLA[SQLite Adapter]
    end
    
    subgraph "Backend"
        API[Express API Routes]
        DB[(SQLite Database)]
    end
    
    UI --> TM
    TM --> SM
    INIT --> SM
    SM --> LS
    SM --> IDB
    SM --> SQLITE
    LS --> LSA
    IDB --> IDBA
    SQLITE --> SQLA
    SQLA --> API
    API --> DB
    
    classDef critical fill:#fee2e2,stroke:#dc2626,stroke-width:2px
    classDef warning fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    class TM critical
    class INIT warning
                </div>
            </div>
        </section>

        <!-- Critical Issues -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Critical Issues Identified</h2>
                
                <!-- Issue 1: God Class -->
                <div class="issue-card priority-high bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-red-800 mb-3">üö® God Class Pattern - FPLTeamManager</h3>
                    <div class="file-path">script.js:1-691</div>
                    <p class="text-gray-700 mb-4">
                        The main controller class violates Single Responsibility Principle with 691 lines handling business logic, 
                        state coordination, and backward compatibility.
                    </p>
                    <div class="code-block">
<code>class FPLTeamManager {
  constructor(options = {}) {
    // 20+ lines of initialization
    this.storage = options.storage;
    this.uiManager = new UIManager(this);
    // ... more initialization
  }

  // 17+ public methods mixing concerns
  async addPlayer(playerData) { /* business logic */ }
  async updatePlayer(playerId, updates) { /* business logic */ }
  async toggleHave(playerId) { /* business logic + DOM */ }
  
  // Legacy sync methods (lines 596-682)
  getCurrentWeekNumber() { /* synchronous */ }
  getWeekCount() { /* synchronous */ }
  
  // Private helpers (10+ methods)
  async _getRootData() { /* 78 lines of complexity */ }
  async _saveRootData(root) { /* storage logic */ }
}</code>
                    </div>
                    <div class="mt-4 grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Impact</h4>
                            <ul class="list-disc list-inside text-gray-600 text-sm">
                                <li>Difficult to test and maintain</li>
                                <li>High coupling between concerns</li>
                                <li>Blocks future enhancements</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Recommendation</h4>
                            <p class="text-gray-600 text-sm">
                                Split into domain services: PlayerService, WeekService, CaptaincyService
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Issue 2: Code Duplication -->
                <div class="issue-card priority-high bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-red-800 mb-3">üîÑ Critical Code Duplication - Normalization Logic</h3>
                    <p class="text-gray-700 mb-4">
                        Identical normalization patterns duplicated across 4 locations creating maintenance burden.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Frontend Locations</h4>
                            <div class="file-path">js/storage-module.js:190-247</div>
                            <div class="code-block">
<code>function normalizeRoot(root) {
  if (!root || typeof root !== 'object') {
    return createDefaultRoot();
  }
  const normalized = { ...root };
  // ... 57 lines of normalization logic
}</code>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Backend Locations</h4>
                            <div class="file-path">server/database.js:196-233</div>
                            <div class="code-block">
<code>function normalizeWeeks(weeks) {
  // Similar normalization logic
  // 37 lines duplicating frontend logic
}</code>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded p-4">
                        <h4 class="font-semibold text-red-800">Duplication Impact</h4>
                        <ul class="list-disc list-inside text-red-700 text-sm">
                            <li>4 separate implementations to maintain</li>
                            <li>Inconsistent validation between frontend/backend</li>
                            <li>Bug propagation across multiple files</li>
                            <li>15% increase in codebase size</li>
                        </ul>
                    </div>
                </div>

                <!-- Issue 3: Storage Fragmentation -->
                <div class="issue-card priority-high bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-red-800 mb-3">üóÑÔ∏è Storage Layer Fragmentation</h3>
                    <p class="text-gray-700 mb-4">
                        Multiple overlapping storage concepts creating confusion and maintenance overhead.
                    </p>
                    
                    <div class="mermaid">
graph LR
    subgraph "Storage Concepts"
        A[storage-module.js<br/>Factory Pattern]
        B[storage-db.js<br/>IndexedDB Implementation]
        C[storage.js<br/>Legacy Wrapper]
        D[adapters/<br/>3 Separate Adapters]
    end
    
    A --> B
    A --> C
    A --> D
    
    classDef fragmented fill:#fef3c7,stroke:#f59e0b
    class A,B,C,D fragmented
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4 mt-4">
                        <div class="bg-gray-50 p-4 rounded">
                            <h4 class="font-semibold text-gray-800">Current State</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>4 different storage abstractions</li>
                                <li>Inconsistent APIs</li>
                                <li>Redundant functionality</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 p-4 rounded">
                            <h4 class="font-semibold text-gray-800">Problems</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>Developer confusion</li>
                                <li>Testing complexity</li>
                                <li>Maintenance overhead</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 p-4 rounded">
                            <h4 class="font-semibold text-gray-800">Solution</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>Unified StorageService facade</li>
                                <li>Standardized adapter contract</li>
                                <li>Deprecate redundant code</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Issue 4: Complex Initialization -->
                <div class="issue-card priority-medium bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">‚öôÔ∏è Complex Initialization Logic</h3>
                    <div class="file-path">js/app-init.js:80-228</div>
                    <p class="text-gray-700 mb-4">
                        The initialization function has cyclomatic complexity of ~15 with 5+ levels of nested conditionals.
                    </p>
                    <div class="code-block">
<code>async function createInitializedStorageService(options = {}) {
  // 148 lines of complex logic
  const { backend, useIndexedDB, timeoutMs } = options;
  
  if (backend === 'sqlite') {
    // SQLite initialization path (30+ lines)
  } else if (useIndexedDB) {
    // IndexedDB path with fallback (40+ lines)
    if (fallbackInfo) {
      // Fallback to localStorage (20+ lines)
    }
  } else {
    // Direct localStorage (15+ lines)
  }
  
  // Error handling and timeout logic (20+ lines)
  // Diagnostic logging scattered throughout
}</code>
                    </div>
                    <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded p-4">
                        <h4 class="font-semibold text-yellow-800">Complexity Issues</h4>
                        <ul class="list-disc list-inside text-yellow-700 text-sm">
                            <li>Multiple responsibilities in single function</li>
                            <li>Hard to test individual code paths</li>
                            <li>Error handling mixed with business logic</li>
                            <li>Diagnostic logging scattered throughout</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- UI Patterns Analysis -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">UI Patterns Analysis</h2>
                
                <!-- DOM Manipulation -->
                <div class="issue-card priority-medium bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">üé® Manual DOM Construction</h3>
                    <div class="file-path">js/ui-manager.js:312-460</div>
                    <p class="text-gray-700 mb-4">
                        UIManager uses imperative DOM manipulation creating brittle, hard-to-test code.
                    </p>
                    <div class="code-block">
<code>buildRowFromTemplate(player, { isReadOnly, captainId, viceCaptainId }) {
  // 148 lines of manual DOM manipulation
  const nameCell = row.querySelector('.col-name');
  if (nameCell) nameCell.textContent = player.name;
  
  const priceCell = row.querySelector('.col-price');
  if (priceCell) priceCell.textContent = `¬£${player.price}`;
  
  const positionCell = row.querySelector('.col-position');
  if (positionCell) positionCell.textContent = player.position;
  
  // Repeated pattern for 10+ cells
  // No data binding, creates new nodes every render
}</code>
                    </div>
                    <div class="mt-4 grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Current Problems</h4>
                            <ul class="list-disc list-inside text-gray-600 text-sm">
                                <li>Brittle selector dependencies</li>
                                <li>No data binding</li>
                                <li>Difficult to test</li>
                                <li>Poor performance (re-creates DOM)</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Modern Alternatives</h4>
                            <ul class="list-disc list-inside text-gray-600 text-sm">
                                <li>lit-html for declarative templates</li>
                                <li>Virtual DOM diffing</li>
                                <li>Component-based architecture</li>
                                <li>Data binding libraries</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Modal System -->
                <div class="issue-card priority-medium bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">ü™ü Fragile Modal System</h3>
                    <div class="file-path">js/ui-manager.js:151-178</div>
                    <p class="text-gray-700 mb-4">
                        Modal creation depends on HTML templates with poor error handling.
                    </p>
                    <div class="code-block">
<code>buildModalFromTemplate() {
  const playerModalTemplate = doc.getElementById('player-modal-template');
  if (!playerModalTemplate) {
    return console.error('Modal template not found');  // Silent failure!
  }
  
  const frag = playerModalTemplate.content.cloneNode(true);
  doc.body.appendChild(frag);
  this.modal = doc.getElementById('player-modal');
}</code>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                        <h4 class="font-semibold text-yellow-800">System Fragility</h4>
                        <ul class="list-disc list-inside text-yellow-700 text-sm">
                            <li>Template must exist in HTML - fragile dependency</li>
                            <li>Error handling via console.error - no user feedback</li>
                            <li>Tests require special setup (seen in jest.setup.js)</li>
                            <li>Race condition potential on first use</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Backend Analysis -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Backend & Storage Analysis</h2>
                
                <!-- Database Schema -->
                <div class="issue-card priority-medium bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">üóÉÔ∏è Suboptimal Database Schema</h3>
                    <div class="file-path">server/database.js:96-107</div>
                    <p class="text-gray-700 mb-4">
                        Current schema uses JSON blobs instead of relational design, causing performance and integrity issues.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Current Schema</h4>
                            <div class="code-block">
<code>CREATE TABLE IF NOT EXISTS meta (
  key TEXT PRIMARY KEY,
  value TEXT  -- Entire root as JSON blob
);

CREATE TABLE IF NOT EXISTS weeks (
  week_number INTEGER PRIMARY KEY,
  payload TEXT NOT NULL,  -- Week data as JSON blob
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);</code>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Recommended Schema</h4>
                            <div class="code-block">
<code>CREATE TABLE players (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  position TEXT,
  team TEXT,
  price REAL
);

CREATE TABLE team_snapshots (
  week_number INTEGER,
  player_id TEXT,
  was_captain BOOLEAN,
  was_vice_captain BOOLEAN,
  notes TEXT,
  FOREIGN KEY (player_id) REFERENCES players(id),
  PRIMARY KEY (week_number, player_id)
);</code>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                        <h4 class="font-semibold text-yellow-800">Schema Issues</h4>
                        <ul class="list-disc list-inside text-yellow-700 text-sm">
                            <li>Schema-less JSON blobs - no relational integrity</li>
                            <li>Redundant storage in meta and weeks tables</li>
                            <li>syncWeeksFromRoot() required for consistency</li>
                            <li>No indexes - full table scans</li>
                            <li>No migration strategy</li>
                        </ul>
                    </div>
                </div>

                <!-- API Design -->
                <div class="issue-card priority-low bg-white border rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-green-800 mb-3">üåê API Design Review</h3>
                    <div class="file-path">server/routes/storage.js:1-125</div>
                    <p class="text-gray-700 mb-4">
                        REST API is functional but missing modern features for scalability.
                    </p>
                    
                    <div class="mermaid">
graph TB
    subgraph "Current API"
        A[GET /root]
        B[PUT /root]
        C[GET /weeks]
        D[GET /weeks/:id]
        E[POST /weeks]
        F[PUT /weeks/:id]
        G[DELETE /weeks/:id]
    end
    
    subgraph "Missing Features"
        H[Pagination]
        I[Bulk Operations]
        J[ETags/Versioning]
        K[Validation Middleware]
        L[OpenAPI Documentation]
    end
    
    style H fill:#fee2e2
    style I fill:#fee2e2
    style J fill:#fee2e2
    style K fill:#fee2e2
    style L fill:#fee2e2
                    </div>
                    
                    <div class="mt-4 grid md:grid-cols-3 gap-4">
                        <div class="bg-green-50 p-4 rounded">
                            <h4 class="font-semibold text-green-800">‚úÖ Strengths</h4>
                            <ul class="text-sm text-green-700 list-disc list-inside">
                                <li>Clean error handling</li>
                                <li>Proper HTTP status codes</li>
                                <li>Type validation</li>
                            </ul>
                        </div>
                        <div class="bg-red-50 p-4 rounded">
                            <h4 class="font-semibold text-red-800">‚ùå Gaps</h4>
                            <ul class="text-sm text-red-700 list-disc list-inside">
                                <li>No pagination</li>
                                <li>No bulk operations</li>
                                <li>No concurrency control</li>
                            </ul>
                        </div>
                        <div class="bg-blue-50 p-4 rounded">
                            <h4 class="font-semibold text-blue-800">üîß Enhancements</h4>
                            <ul class="text-sm text-blue-700 list-disc list-inside">
                                <li>Request validation middleware</li>
                                <li>ETag support</li>
                                <li>OpenAPI spec</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testing Strategy -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Testing Strategy Review</h2>
                
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded text-center">
                        <div class="text-2xl font-bold text-blue-800">40</div>
                        <div class="text-sm text-blue-600">Test Files</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded text-center">
                        <div class="text-2xl font-bold text-green-800">162</div>
                        <div class="text-sm text-green-600">Test Cases</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded text-center">
                        <div class="text-2xl font-bold text-yellow-800">2000</div>
                        <div class="text-sm text-yellow-600">Lines of Boilerplate</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded text-center">
                        <div class="text-2xl font-bold text-red-800">15%</div>
                        <div class="text-sm text-red-600">Mock Over-reliance</div>
                    </div>
                </div>

                <!-- Test Coverage Gaps -->
                <div class="issue-card priority-medium bg-white border rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">üß™ Test Coverage Gaps</h3>
                    <p class="text-gray-700 mb-4">
                        While test quantity is good, critical scenarios are missing or over-mocked.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Missing Scenarios</h4>
                            <ul class="list-disc list-inside text-gray-600 text-sm">
                                <li>Storage timeout handling</li>
                                <li>Network failures (SQLite backend)</li>
                                <li>Corrupted data recovery</li>
                                <li>Migration failures</li>
                                <li>Concurrent modifications</li>
                                <li>Empty states and boundaries</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Over-Mocked Areas</h4>
                            <ul class="list-disc list-inside text-gray-600 text-sm">
                                <li>Storage adapters (mocked instead of real)</li>
                                <li>DOM interactions (excessive stubbing)</li>
                                <li>Network requests (always mocked)</li>
                                <li>Browser APIs (comprehensive stubbing)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded p-4">
                        <h4 class="font-semibold text-yellow-800">Test Setup Duplication</h4>
                        <div class="code-block">
<code>// Repeated in 15+ test files
beforeEach(() => {
  const mockLocalStorage = {
    getItem: jest.fn((key) => store[key] || null),
    setItem: jest.fn((key, value) => { store[key] = value; }),
  };
  
  const storageAdapter = {
    getRootData: jest.fn(async () => mockRoot),
    setRootData: jest.fn(async (root) => { /* ... */ }),
  };
  
  // 50+ lines of boilerplate per test file
});</code>
                        </div>
                    </div>
                </div>

                <!-- Test File Naming -->
                <div class="issue-card priority-low bg-white border rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-green-800 mb-3">üìÅ Test Organization Issues</h3>
                    <p class="text-gray-700 mb-4">
                        Inconsistent naming makes it difficult to understand test scope and purpose.
                    </p>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-800">Current Inconsistent Patterns</h4>
                            <ul class="font-mono text-sm text-gray-600 list-disc list-inside">
                                <li>alert-tests.js</li>
                                <li>alerts.test.js</li>
                                <li>alert-simple.test.js</li>
                                <li>weekNavigation.test.js</li>
                                <li>weekNavigation.clean.test.js</li>
                                <li>weekNavigation.new.test.js</li>
                                <li>weekNavigation.updated.test.js</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Recommended Standardization</h4>
                            <ul class="font-mono text-sm text-gray-600 list-disc list-inside">
                                <li>*.test.js - Unit tests</li>
                                <li>*.integration.test.js - Integration tests</li>
                                <li>*.e2e.test.js - End-to-end tests</li>
                                <li>*.workflow.test.js - Workflow tests</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Refactoring Priority Matrix -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Refactoring Priority Matrix</h2>
                
                <!-- High Priority -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-red-800 mb-4">üö® HIGH PRIORITY (Critical Technical Debt)</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Effort</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Files</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommendation</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="priority-high">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Normalization Logic Duplication</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">4 files</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Extract to js/models/</td>
                                </tr>
                                <tr class="priority-high">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">FPLTeamManager God Class</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">script.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Split into domain services</td>
                                </tr>
                                <tr class="priority-high">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Storage Layer Fragmentation</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">/js/storage*</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Consolidate with facade</td>
                                </tr>
                                <tr class="priority-high">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Error Handling Inconsistency</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">All frontend</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Implement ErrorBoundary</td>
                                </tr>
                                <tr class="priority-high">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">State Management Inefficiency</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">script.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Add caching layer</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Medium Priority -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-4">‚ö†Ô∏è MEDIUM PRIORITY (Maintainability)</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Effort</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Files</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommendation</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="priority-medium">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Complex Initialization</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">app-init.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Extract strategy pattern</td>
                                </tr>
                                <tr class="priority-medium">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Manual DOM Construction</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ui-manager.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Consider templating library</td>
                                </tr>
                                <tr class="priority-medium">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Modal System Fragility</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ui-manager.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Programmatic creation</td>
                                </tr>
                                <tr class="priority-medium">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">SQLite Schema Design</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">High</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">server/database.js</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Normalize database</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Low Priority -->
                <div>
                    <h3 class="text-xl font-semibold text-green-800 mb-4">‚úÖ LOW PRIORITY (Nice to Have)</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Effort</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Files</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recommendation</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="priority-low">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Test File Naming</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">__tests__/</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Rename for consistency</td>
                                </tr>
                                <tr class="priority-low">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Code Comments Sparse</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">All files</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Add JSDoc</td>
                                </tr>
                                <tr class="priority-low">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Adapter API Differences</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">/js/adapters/</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Standardize contract</td>
                                </tr>
                                <tr class="priority-low">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">No Bulk API Operations</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Low</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Medium</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">server/routes/</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Add batch endpoints</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modernization Roadmap -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Modernization Roadmap</h2>
                
                <div class="mermaid">
gantt
    title FPL Refactoring Timeline
    dateFormat  YYYY-MM-DD
    section Phase 1: Foundation
    Extract Shared Models     :a1, 2025-01-06, 7d
    Consolidate Storage      :a2, after a1, 7d
    Error Handling           :a3, after a2, 7d
    
    section Phase 2: Components
    Refactor FPLTeamManager  :b1, after a3, 14d
    UI Manager Improvements  :b2, after b1, 14d
    Testing Improvements     :b3, after b2, 7d
    
    section Phase 3: Backend
    Database Normalization   :c1, after b3, 14d
    API Enhancements         :c2, after c1, 7d
                </div>

                <!-- Phase 1 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">üîß Phase 1: Foundation Cleanup (2-3 weeks)</h3>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">Week 1: Extract Shared Models</h4>
                            <div class="text-sm text-blue-700">
                                <p class="mb-2"><strong>Create:</strong> js/models/</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>week-model.js (normalization, validation)</li>
                                    <li>player-model.js</li>
                                    <li>root-model.js</li>
                                </ul>
                                <p class="mt-2"><strong>Refactor:</strong> Update all imports</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">Week 2: Consolidate Storage</h4>
                            <div class="text-sm text-blue-700">
                                <p class="mb-2"><strong>Create:</strong> js/storage/</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>storage-service.js (unified facade)</li>
                                    <li>adapters/ (move existing)</li>
                                    <li>storage-cache.js (new caching)</li>
                                </ul>
                                <p class="mt-2"><strong>Deprecate:</strong> storage.js</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">Week 3: Error Handling</h4>
                            <div class="text-sm text-blue-700">
                                <p class="mb-2"><strong>Create:</strong> js/utils/</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>error-handler.js</li>
                                    <li>app-error.js (custom errors)</li>
                                </ul>
                                <p class="mt-2"><strong>Implement:</strong> Global error boundary</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Phase 2 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-purple-800 mb-4">üé® Phase 2: Component Modernization (3-4 weeks)</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">Week 4-5: Refactor FPLTeamManager</h4>
                            <div class="text-sm text-purple-700">
                                <p class="mb-2"><strong>Extract services:</strong></p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>player-service.js (add, update, delete)</li>
                                    <li>week-service.js (navigation, creation)</li>
                                    <li>captaincy-service.js (captain/vice)</li>
                                </ul>
                                <p class="mt-2"><strong>Result:</strong> FPLTeamManager ‚Üí thin orchestrator (~200 lines)</p>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">Week 6: UI Manager Improvements</h4>
                            <div class="text-sm text-purple-700">
                                <p class="mb-2"><strong>Options:</strong></p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Add lit-html for declarative templates</li>
                                    <li>Extract components (PlayerRow, WeekControls)</li>
                                    <li>Implement virtual DOM diffing</li>
                                </ul>
                                <p class="mt-2"><strong>Benefit:</strong> Reduce DOM manipulation by 50%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Phase 3 -->
                <div>
                    <h3 class="text-xl font-semibold text-green-800 mb-4">üóÑÔ∏è Phase 3: Backend Optimization (2-3 weeks)</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">Week 8-9: Database Normalization</h4>
                            <div class="text-sm text-green-700">
                                <p class="mb-2"><strong>Tasks:</strong></p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Design normalized schema</li>
                                    <li>Implement migration scripts</li>
                                    <li>Update database.js queries</li>
                                    <li>Remove syncWeeksFromRoot()</li>
                                </ul>
                                <p class="mt-2"><strong>Benefit:</strong> 40% storage reduction, proper integrity</p>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">Week 10: API Enhancements</h4>
                            <div class="text-sm text-green-700">
                                <p class="mb-2"><strong>Add:</strong></p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Request validation middleware</li>
                                    <li>Pagination for GET /weeks</li>
                                    <li>Bulk update endpoint</li>
                                    <li>ETag support for optimistic locking</li>
                                </ul>
                                <p class="mt-2"><strong>Document:</strong> OpenAPI/Swagger spec</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testing Recommendations -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Testing Recommendations</h2>
                
                <!-- Missing Test Scenarios -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-orange-800 mb-4">üß™ Add Missing Test Scenarios</h3>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2">Priority Test Cases</h4>
                            <div class="text-sm text-orange-700">
                                <div class="code-block mb-3">
<code>test('handles concurrent week updates', async () => {
  // Two tabs modifying same week
  // Conflict detection?
});</code>
                                </div>
                                <div class="code-block">
<code>test('recovers from IndexedDB quota exceeded', async () => {
  // Mock quota error
  // Should fallback to localStorage
});</code>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2">Edge Cases</h4>
                            <div class="text-sm text-orange-700">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Empty states</li>
                                    <li>Maximum team size (15 players)</li>
                                    <li>Week navigation boundaries</li>
                                    <li>Concurrent modifications</li>
                                    <li>Corrupted data recovery</li>
                                    <li>Migration failures</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2">Integration Gaps</h4>
                            <div class="text-sm text-orange-700">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Full import/export workflow</li>
                                    <li>Storage backend switching</li>
                                    <li>Legacy data migration</li>
                                    <li>Error recovery flows</li>
                                    <li>Performance benchmarks</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Improved Test Strategy -->
                <div>
                    <h3 class="text-xl font-semibold text-orange-800 mb-4">üìà Improved Test Strategy</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">Real Storage Testing</h4>
                            <p class="text-gray-600 text-sm mb-3">Replace mocks with real implementations:</p>
                            <div class="code-block">
<code>// Instead of mocking localStorage
const realLocalStorage = new Map();
const storageAdapter = new LocalStorageAdapter({
  storage: realLocalStorage
});

// Use fake-indexeddb for IndexedDB tests
import 'fake-indexeddb/auto';</code>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">Workflow Testing</h4>
                            <p class="text-gray-600 text-sm mb-3">Add end-to-end workflow tests:</p>
                            <div class="code-block">
<code>// __tests__/workflows/full-season.workflow.test.js
test('complete season workflow', async () => {
  // 1. Add players
  // 2. Create 38 weeks  
  // 3. Navigate between weeks
  // 4. Export data
  // 5. Import to new instance
});</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Specific Actions -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Specific Actionable Recommendations</h2>
                
                <!-- Immediate Actions -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-red-800 mb-4">üöÄ Immediate Actions (This Sprint)</h3>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">1Ô∏è‚É£</span>
                                <h4 class="font-semibold text-red-800">Extract WeekModel</h4>
                            </div>
                            <p class="text-sm text-red-700 mb-2">Move normalization to shared models</p>
                            <div class="text-xs text-red-600">
                                <p>‚è±Ô∏è 4 hours</p>
                                <p>üìÅ js/models/week-model.js</p>
                                <p>üéØ Remove 4x duplication</p>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">2Ô∏è‚É£</span>
                                <h4 class="font-semibold text-red-800">Add Error Boundary</h4>
                            </div>
                            <p class="text-sm text-red-700 mb-2">Implement unified error handling</p>
                            <div class="text-xs text-red-600">
                                <p>‚è±Ô∏è 3 hours</p>
                                <p>üìÅ js/utils/error-handler.js</p>
                                <p>üéØ User-friendly errors</p>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">3Ô∏è‚É£</span>
                                <h4 class="font-semibold text-red-800">Standardize Test Naming</h4>
                            </div>
                            <p class="text-sm text-red-700 mb-2">Consistent test file organization</p>
                            <div class="text-xs text-red-600">
                                <p>‚è±Ô∏è 1 hour</p>
                                <p>üìÅ __tests__/</p>
                                <p>üéØ Better discoverability</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Next Sprint -->
                <div>
                    <h3 class="text-xl font-semibold text-yellow-800 mb-4">üìÖ Next Sprint Actions</h3>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">4Ô∏è‚É£</span>
                                <h4 class="font-semibold text-yellow-800">Refactor Initialization</h4>
                            </div>
                            <p class="text-sm text-yellow-700 mb-2">Extract StorageInitializer class</p>
                            <div class="text-xs text-yellow-600">
                                <p>‚è±Ô∏è 8 hours</p>
                                <p>üìÅ js/app-init.js</p>
                                <p>üéØ Reduce complexity</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">5Ô∏è‚É£</span>
                                <h4 class="font-semibold text-yellow-800">Consolidate Storage</h4>
                            </div>
                            <p class="text-sm text-yellow-700 mb-2">Unified StorageService facade</p>
                            <div class="text-xs text-yellow-600">
                                <p>‚è±Ô∏è 12 hours</p>
                                <p>üìÅ js/storage/</p>
                                <p>üéØ Remove fragmentation</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">6Ô∏è‚É£</span>
                                <h4 class="font-semibold text-yellow-800">Add Workflow Tests</h4>
                            </div>
                            <p class="text-sm text-yellow-700 mb-2">End-to-end user journeys</p>
                            <div class="text-xs text-yellow-600">
                                <p>‚è±Ô∏è 6 hours</p>
                                <p>üìÅ __tests__/workflows/</p>
                                <p>üéØ Catch integration bugs</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary & Metrics -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6">Summary & Key Metrics</h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Current State</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Total Lines of Code:</span>
                                <span class="font-bold">~15,000</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Code Duplication:</span>
                                <span class="font-bold">15%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Average Function Length:</span>
                                <span class="font-bold">25 lines</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Test Coverage:</span>
                                <span class="font-bold">Good (162 tests)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Technical Debt Ratio:</span>
                                <span class="font-bold">Medium-High</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Target State (After Refactoring)</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Code Reduction:</span>
                                <span class="font-bold">-20%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Average Function Length:</span>
                                <span class="font-bold">&lt;15 lines</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Test Boilerplate:</span>
                                <span class="font-bold">-60%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Maintainability Index:</span>
                                <span class="font-bold">65 ‚Üí 80</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Development Velocity:</span>
                                <span class="font-bold">+30%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-white/20">
                    <h3 class="text-xl font-semibold mb-4">ROI of Refactoring</h3>
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold">+30%</div>
                            <div class="text-sm opacity-90">Development Velocity</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold">-40%</div>
                            <div class="text-sm opacity-90">Bug Rate</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold">-50%</div>
                            <div class="text-sm opacity-90">Onboarding Time</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold">‚Üí</div>
                            <div class="text-sm opacity-90">Same Test Speed</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Conclusion -->
        <section class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8 mb-12">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Conclusion</h2>
                <p class="text-gray-700 leading-relaxed mb-4">
                    This comprehensive analysis provides a complete roadmap for systematic refactoring of the FPL Team Management application. 
                    The identified issues, while significant, are addressable through a phased approach that minimizes disruption while maximizing value.
                </p>
                <p class="text-gray-700 leading-relaxed mb-4">
                    <strong>Key Takeaways:</strong>
                </p>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li>Start with <strong>high-priority items</strong> - they remove blockers for everything else</li>
                    <li>Focus on <strong>code duplication elimination</strong> - provides immediate maintainability benefits</li>
                    <li>Implement <strong>proper error handling</strong> - improves user experience and debugging</li>
                    <li>Consider <strong>modern UI patterns</strong> for long-term maintainability</li>
                    <li>Invest in <strong>real testing</strong> over extensive mocking</li>
                </ul>
                <p class="text-gray-700 leading-relaxed mt-4">
                    The proposed 10-week roadmap balances technical improvements with continued feature delivery, ensuring the application 
                    remains functional while gradually modernizing its architecture. Each phase builds upon the previous one, creating a solid 
                    foundation for future enhancements and scalability.
                </p>
                
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-blue-800 font-semibold">
                        üéØ <strong>Recommendation:</strong> Begin with WeekModel extraction this week - it's low-risk, high-impact, and immediately reduces technical debt.
                    </p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-8 no-print">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <p class="text-lg font-semibold">Refactoring Opportunity Review</p>
                    <p class="text-gray-400">FPL Team Management Application - January 2026</p>
                    <p class="text-gray-500 text-sm mt-2">Generated on January 3, 2026 | Comprehensive Architecture Analysis</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#1a202c',
                primaryBorderColor: '#667eea',
                lineColor: '#cbd5e0',
                sectionBkgColor: '#f7fafc',
                altSectionBkgColor: '#edf2f7',
                gridColor: '#e2e8f0',
                secondaryColor: '#764ba2',
                tertiaryColor: '#fbbf24'
            }
        });

        // Initialize Prism for syntax highlighting
        Prism.highlightAll();
        
        // Add smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Print functionality
        function printReport() {
            window.print();
        }
        
        // Add print button (if needed)
        if (window.location.pathname.includes('refactoring_review')) {
            const printBtn = document.createElement('button');
            printBtn.textContent = 'üñ®Ô∏è Print Report';
            printBtn.className = 'fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700 no-print';
            printBtn.onclick = printReport;
            document.body.appendChild(printBtn);
        }
    </script>
</body>
</html>
